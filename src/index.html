<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>florecer</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="auth-container">
        <div id="login-form" class="auth-form">
            <h2>Iniciar sesión</h2>
            <form>
                <label for="login-user">Usuario o Email:</label>
                <input type="text" id="login-user" required>
                <label for="login-password">Contraseña:</label>
                <input type="password" id="login-password" required>
                <label style="display:flex;align-items:center;margin-top:1rem;">
                    <input type="checkbox" id="keep-logged" style="margin-right:0.5rem;"> Mantener sesión iniciada
                </label>
                <button type="submit">Entrar</button>
            </form>
            <p>¿No tienes cuenta? <a href="#" id="show-register">Regístrate</a></p>
            <p id="login-error" style="color:red;display:none;"></p>
            <button id="ver-usuarios-btn" type="button" style="margin-top:1rem;">Ver usuarios guardados</button>
            <div id="usuarios-guardados" style="display:none;margin-top:1rem;background:#f7f7f7;padding:1rem;border-radius:8px;"></div>
        </div>
        <div id="register-form" class="auth-form" style="display:none">
            <h2>Registrarse</h2>
            <form>
                <label for="register-nombre">Nombre:</label>
                <input type="text" id="register-nombre" required>
                <label for="register-apellidos">Apellidos:</label>
                <input type="text" id="register-apellidos" required>
                <label for="register-user">Usuario:</label>
                <input type="text" id="register-user" required>
                <label for="register-email">Email:</label>
                <input type="email" id="register-email" required>
                <label for="register-password">Contraseña:</label>
                <input type="password" id="register-password" required>
                <label for="register-password2">Verificar contraseña:</label>
                <input type="password" id="register-password2" required>
                <button type="submit" id="continuar-btn" style="display:flex;align-items:center;gap:0.5rem;justify-content:center;">
                    Continuar <span style="font-size:1.3em;">&#8594;</span>
                </button>
            </form>
            <p>¿Ya tienes cuenta? <a href="#" id="show-login">Inicia sesión</a></p>
            <p id="register-error" style="color:red;display:none;"></p>
        </div>
    </div>
    <!-- Quitar bienestar mental de panel de opciones y configuración -->
    <div id="personaliza_panel" class="auth-form" style="display:none">
        <h2>Personaliza tu experiencia</h2>
        <form>
            <h3>Nutrición</h3>
            <label><input type="checkbox" name="nutricion" value="deficiencias"> Deficiencias nutricionales</label><br>
            <label><input type="checkbox" name="nutricion" value="sobrepeso"> Sobrepeso u obesidad</label><br>
            <label><input type="checkbox" name="nutricion" value="desnutricion"> Desnutrición</label><br>
            <label><input type="checkbox" name="nutricion" value="alergias"> Alergias alimentarias</label><br>
            <label><input type="checkbox" name="nutricion" value="intolerancias"> Intolerancias alimentarias</label><br>
            <label><input type="checkbox" name="nutricion" value="deshidratacion"> Deshidratación</label><br>
            <label><input type="checkbox" name="nutricion" value="digestivos"> Problemas de digestión</label><br>
            <h3>Cabello</h3>
            <label><input type="checkbox" name="cabello" value="caida"> Caída del cabello</label><br>
            <label><input type="checkbox" name="cabello" value="seco"> Cabello seco y quebradizo</label><br>
            <label><input type="checkbox" name="cabello" value="grasoso"> Cabello grasoso</label><br>
            <label><input type="checkbox" name="cabello" value="caspa"> Caspa</label><br>
            <label><input type="checkbox" name="cabello" value="calor"> Cabello dañado por el calor</label><br>
            <label><input type="checkbox" name="cabello" value="tenido"> Cabello teñido o decolorado</label><br>
            <label><input type="checkbox" name="cabello" value="encrespado"> Cabello encrespado</label><br>
            <label><input type="checkbox" name="cabello" value="alopecia"> Alopecia</label><br>
            <h3>Piel</h3>
            <label><input type="checkbox" name="piel" value="acne"> Acné</label><br>
            <label><input type="checkbox" name="piel" value="seca"> Piel seca</label><br>
            <label><input type="checkbox" name="piel" value="grasosa"> Piel grasosa</label><br>
            <label><input type="checkbox" name="piel" value="hiperpigmentacion"> Hiperpigmentación</label><br>
            <label><input type="checkbox" name="piel" value="arrugas"> Arrugas y líneas finas</label><br>
            <label><input type="checkbox" name="piel" value="sensibilidad"> Sensibilidad en la piel</label><br>
            <label><input type="checkbox" name="piel" value="eccema"> Eccema</label><br>
            <label><input type="checkbox" name="piel" value="rosacea"> Rosácea</label><br>
            <h4>Tipos de piel</h4>
            <label><input type="radio" name="tipo_piel" value="normal"> Normal</label>
            <label><input type="radio" name="tipo_piel" value="seca"> Seca</label>
            <label><input type="radio" name="tipo_piel" value="grasosa"> Grasosa</label>
            <label><input type="radio" name="tipo_piel" value="mixta"> Mixta</label>
            <label><input type="radio" name="tipo_piel" value="sensible"> Sensible</label>
            <br>
            <button type="submit">Guardar y continuar</button>
        </form>
    </div>
    <div id="main-content" style="display:none">
        <header>
            <h1 style="font-size:3rem; margin-bottom:0.3rem; text-align:center;">florecer</h1>
            <div style="text-align:center; font-size:1.3rem; color:#7b3f00; font-style:italic; margin-bottom:1.2rem;">La piel que mereces, el cuidado que necesitas</div>
            <nav class="main-nav" style="display:flex;justify-content:center;gap:2rem;margin-bottom:1.5rem;">
                <a href="#" class="nav-link" data-section="inicio">Inicio</a>
                <a href="#" class="nav-link" data-section="feed-recomendaciones">Feed</a>
                <a href="#" class="nav-link" data-section="tienda">Tienda</a>
                <a href="#" class="nav-link" data-section="carrito">Carrito</a>
                <a href="#" class="nav-link" data-section="perfil">Perfil</a>
                <a href="#" class="nav-link" data-section="configuracion">Configuración</a>
                <a href="#" class="nav-link" data-section="favoritos-rutinas">Favoritos y Rutinas</a>
                <a href="#" class="nav-link" data-section="buscador">Buscador</a>
            </nav>
        </header>
        <main>
            <section id="inicio" class="main-section">
                <h2 id="bienvenida-usuario">Inicio</h2>
                <div class="feed">
                    <article class="post">
                        <img src="https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=400&q=80" alt="Bienestar" />
                        <div>
                            <h3>¡Cuida tu mente y cuerpo!</h3>
                            <p>Descubre rutinas diarias para sentirte mejor cada día.</p>
                        </div>
                    </article>
                </div>
            </section>
            <!-- Nutrición -->
            <section id="nutricion-deficiencias" class="main-section" style="display:none">
                <h2>Deficiencias nutricionales</h2>
                <ul>
                    <li>Problema: Falta de nutrientes esenciales como vitaminas, minerales o proteínas.</li>
                    <li>Solución: Dieta equilibrada, suplementos bajo supervisión, consulta con nutricionista.</li>
                    <li>Productos: Suplementos vitamínicos ($5-$20), alimentos fortificados ($5-$15), Ensure ($20-$100).</li>
                    <li>Marcas: Centrum, Nature's Bounty, Garden of Life, Ensure.</li>
                </ul>
            </section>
            <section id="nutricion-sobrepeso" class="main-section" style="display:none">
                <h2>Sobrepeso u obesidad</h2>
                <ul>
                    <li>Problema: Exceso de peso que puede aumentar el riesgo de enfermedades crónicas.</li>
                    <li>Solución: Dieta saludable, actividad física, metas realistas, consulta profesional.</li>
                    <li>Productos: Suplementos de fibra/proteínas ($10-$50), snacks saludables ($5-$10).</li>
                    <li>Marcas: Herbalife, SlimFast, Ensure, Nature's Bounty.</li>
                </ul>
            </section>
            <section id="nutricion-desnutricion" class="main-section" style="display:none">
                <h2>Desnutrición</h2>
                <ul>
                    <li>Problema: Falta de nutrientes esenciales que puede afectar la salud y el bienestar.</li>
                    <li>Solución: Dieta rica en nutrientes, suplementos, atención médica si es severa.</li>
                    <li>Productos: Suplementos nutricionales ($10-$30), alimentos ricos en nutrientes ($5-$15), Ensure ($20-$100).</li>
                    <li>Marcas: Ensure, Boost, Pediasure, Resource.</li>
                </ul>
            </section>
            <section id="nutricion-alergias" class="main-section" style="display:none">
                <h2>Alergias alimentarias</h2>
                <ul>
                    <li>Problema: Reacciones adversas a ciertos alimentos.</li>
                    <li>Solución: Identificar y evitar alimentos, leer etiquetas, consulta con alergólogo.</li>
                    <li>Productos: Alimentos libres de alérgenos ($5-$15), suplementos nutricionales ($10-$30).</li>
                    <li>Marcas: Enjoy Life Foods, Udi's, Glutino, Bob's Red Mill.</li>
                </ul>
            </section>
            <section id="nutricion-intolerancias" class="main-section" style="display:none">
                <h2>Intolerancias alimentarias</h2>
                <ul>
                    <li>Problema: Dificultad para digerir ciertos alimentos.</li>
                    <li>Solución: Identificar y evitar alimentos, dieta de eliminación, suplementos enzimáticos.</li>
                    <li>Productos: Alimentos sin lactosa/gluten ($5-$15), suplementos enzimáticos ($10-$30).</li>
                    <li>Marcas: Lactaid, Gluten-Free Pantry, So Delicious, Enjoy Life Foods.</li>
                </ul>
            </section>
            <section id="nutricion-deshidratacion" class="main-section" style="display:none">
                <h2>Deshidratación</h2>
                <ul>
                    <li>Problema: Falta de líquidos en el cuerpo.</li>
                    <li>Solución: Beber suficiente agua, evitar alcohol/cafeína, alimentos hidratantes.</li>
                    <li>Productos: Bebidas hidratantes ($1-$5), suplementos de electrolitos ($10-$20).</li>
                    <li>Marcas: Gatorade, Powerade, Nuun, Coconut Water.</li>
                </ul>
            </section>
            <section id="nutricion-digestivos" class="main-section" style="display:none">
                <h2>Problemas de digestión</h2>
                <ul>
                    <li>Problema: Estreñimiento, diarrea o dolor abdominal.</li>
                    <li>Solución: Dieta rica en fibra, agua, evitar alimentos desencadenantes.</li>
                    <li>Productos: Probióticos ($10-$30), suplementos de fibra ($5-$15).</li>
                    <li>Marcas: Garden of Life, Nature's Bounty, Align, Benefiber.</li>
                </ul>
            </section>
            <!-- Cabello -->
            <section id="cabello-caida" class="main-section" style="display:none">
                <h2>Caída del cabello</h2>
                <ul>
                    <li>Problema: Pérdida excesiva de cabello por estrés, genética o deficiencias.</li>
                    <li>Solución: Dieta equilibrada, reducir estrés, productos estimulantes, consulta especialista.</li>
                    <li>Productos: Champús con biotina/keratina ($10-$30), minoxidil ($20-$50), suplementos ($15-$30).</li>
                    <li>Marcas: Nioxin, Rogaine, Pantene, Kerastase.</li>
                </ul>
            </section>
            <section id="cabello-seco" class="main-section" style="display:none">
                <h2>Cabello seco y quebradizo</h2>
                <ul>
                    <li>Problema: Falta de humedad y nutrientes, puntas abiertas.</li>
                    <li>Solución: Mascarillas hidratantes, reducir calor, productos nutritivos.</li>
                    <li>Productos: Mascarillas hidratantes ($10-$25), champús/acondicionadores suaves ($8-$20).</li>
                    <li>Marcas: Moroccanoil, Kerastase, L'Oréal Paris, Aveda.</li>
                </ul>
            </section>
            <section id="cabello-grasoso" class="main-section" style="display:none">
                <h2>Cabello grasoso</h2>
                <ul>
                    <li>Problema: Exceso de sebo, cabello pesado.</li>
                    <li>Solución: Lavar con productos específicos, evitar productos grasos.</li>
                    <li>Productos: Champús para cabello grasoso ($8-$15), productos con té de árbol ($10-$20).</li>
                    <li>Marcas: Pantene, Head & Shoulders, Garnier, Bumble and bumble.</li>
                </ul>
            </section>
            <section id="cabello-caspa" class="main-section" style="display:none">
                <h2>Caspa</h2>
                <ul>
                    <li>Problema: Descamación y picazón en el cuero cabelludo.</li>
                    <li>Solución: Champús anticaspa, reducir estrés, evitar irritantes.</li>
                    <li>Productos: Champús anticaspa ($10-$20), productos con aceite de té de árbol ($10-$25).</li>
                    <li>Marcas: Head & Shoulders, Nizoral, Paul Mitchell, Selsun Blue.</li>
                </ul>
            </section>
            <section id="cabello-calor" class="main-section" style="display:none">
                <h2>Cabello dañado por el calor</h2>
                <ul>
                    <li>Problema: Daño por uso excesivo de calor.</li>
                    <li>Solución: Reducir calor, productos protectores, tratamientos reparadores.</li>
                    <li>Productos: Sprays termo protectores ($10-$20), mascarillas hidratantes ($10-$25).</li>
                    <li>Marcas: Moroccanoil, Bumble and bumble, Redken, Aveda.</li>
                </ul>
            </section>
            <section id="cabello-tenido" class="main-section" style="display:none">
                <h2>Cabello teñido o decolorado</h2>
                <ul>
                    <li>Problema: Pérdida de color o daño por decoloración.</li>
                    <li>Solución: Productos específicos, evitar lavados frecuentes, tratamientos hidratantes.</li>
                    <li>Productos: Productos para cabello teñido ($10-$25), champús/acondicionadores suaves ($8-$20).</li>
                    <li>Marcas: L'Oréal Paris, Wella, Redken, Joico.</li>
                </ul>
            </section>
            <section id="cabello-encrespado" class="main-section" style="display:none">
                <h2>Cabello encrespado</h2>
                <ul>
                    <li>Problema: Cabello frizzy por humedad o daño.</li>
                    <li>Solución: Productos hidratantes, anti-frizz, cortar puntas abiertas.</li>
                    <li>Productos: Aceite de argán/coco ($10-$25), champús/acondicionadores suaves ($8-$20).</li>
                    <li>Marcas: Moroccanoil, Kerastase, Aveda, Bumble and bumble.</li>
                </ul>
            </section>
            <section id="cabello-alopecia" class="main-section" style="display:none">
                <h2>Alopecia</h2>
                <ul>
                    <li>Problema: Pérdida de cabello en áreas específicas.</li>
                    <li>Solución: Consulta especialista, tratamientos médicos, productos estimulantes.</li>
                    <li>Productos: Minoxidil ($20-$50), tratamientos capilares ($15-$30).</li>
                    <li>Marcas: Rogaine, Nioxin, Kerastase.</li>
                </ul>
            </section>
            <!-- Piel -->
            <section id="piel-acne" class="main-section" style="display:none">
                <h2>Acné</h2>
                <ul>
                    <li>Problema: Brotes, puntos negros y espinillas.</li>
                    <li>Solución: Limpieza facial, productos antiacné, consulta dermatológica.</li>
                    <li>Productos: Limpiadores, cremas y tratamientos ($5-$30).</li>
                    <li>Marcas: Neutrogena, Paula's Choice, The Ordinary, La Roche-Posay.</li>
                </ul>
            </section>
            <section id="piel-seca" class="main-section" style="display:none">
                <h2>Piel seca</h2>
                <ul>
                    <li>Problema: Sequedad, descamación, tirantez.</li>
                    <li>Solución: Hidratación, cremas nutritivas, evitar jabones agresivos.</li>
                    <li>Productos: Cremas hidratantes ($5-$20), jabones suaves.</li>
                    <li>Marcas: Cetaphil, CeraVe, L'Oréal Paris, Nivea.</li>
                </ul>
            </section>
            <section id="piel-grasosa" class="main-section" style="display:none">
                <h2>Piel grasosa</h2>
                <ul>
                    <li>Problema: Brillo, poros dilatados, tendencia al acné.</li>
                    <li>Solución: Limpieza regular, productos oil-free, exfoliación suave.</li>
                    <li>Productos: Limpiadores, tónicos, cremas oil-free ($5-$20).</li>
                    <li>Marcas: Proactiv, Neutrogena, La Roche-Posay, Dermalogica.</li>
                </ul>
            </section>
            <section id="piel-hiperpigmentacion" class="main-section" style="display:none">
                <h2>Hiperpigmentación</h2>
                <ul>
                    <li>Problema: Manchas oscuras, tono desigual.</li>
                    <li>Solución: Cremas despigmentantes, protección solar, vitamina C.</li>
                    <li>Productos: Cremas y sueros ($10-$30).</li>
                    <li>Marcas: SkinCeuticals, Obagi, Paula's Choice, The Ordinary.</li>
                </ul>
            </section>
            <section id="piel-arrugas" class="main-section" style="display:none">
                <h2>Arrugas y líneas finas</h2>
                <ul>
                    <li>Problema: Líneas de expresión, pérdida de elasticidad.</li>
                    <li>Solución: Cremas antiedad, retinoides, ácido hialurónico.</li>
                    <li>Productos: Cremas y sueros antiedad ($10-$30).</li>
                    <li>Marcas: Olay, La Roche-Posay, SkinCeuticals, Dermalogica.</li>
                </ul>
            </section>
            <section id="piel-sensibilidad" class="main-section" style="display:none">
                <h2>Sensibilidad en la piel</h2>
                <ul>
                    <li>Problema: Irritación, enrojecimiento, picor.</li>
                    <li>Solución: Productos hipoalergénicos, evitar irritantes, hidratación suave.</li>
                    <li>Productos: Cremas y limpiadores suaves ($5-$20).</li>
                    <li>Marcas: Cetaphil, La Roche-Posay, Avene, Neutrogena.</li>
                </ul>
            </section>
            <section id="piel-eccema" class="main-section" style="display:none">
                <h2>Eccema</h2>
                <ul>
                    <li>Problema: Piel inflamada, seca, con picor.</li>
                    <li>Solución: Cremas emolientes, evitar alérgenos, consulta dermatológica.</li>
                    <li>Productos: Cremas hidratantes y emolientes ($5-$20).</li>
                    <li>Marcas: Cetaphil, Eucerin, La Roche-Posay, CeraVe.</li>
                </ul>
            </section>
            <section id="piel-rosacea" class="main-section" style="display:none">
                <h2>Rosácea</h2>
                <ul>
                    <li>Problema: Enrojecimiento, vasos sanguíneos visibles.</li>
                    <li>Solución: Productos calmantes, evitar irritantes, consulta dermatológica.</li>
                    <li>Productos: Cremas y limpiadores suaves ($5-$20).</li>
                    <li>Marcas: La Roche-Posay, Cetaphil, Dermalogica, SkinCeuticals.</li>
                </ul>
            </section>
            <section id="configuracion" class="main-section" style="display:none">
                <h2>Configuración</h2>
                <div id="config-panel">
                    <h3>Editar preferencias de cuidado personal</h3>
                    <form id="edit-preferencias-form">
                        <h4>Nutrición</h4>
                        <label><input type="checkbox" name="opciones" value="deficiencias"> Deficiencias nutricionales</label><br>
                        <label><input type="checkbox" name="opciones" value="sobrepeso"> Sobrepeso u obesidad</label><br>
                        <label><input type="checkbox" name="opciones" value="desnutricion"> Desnutrición</label><br>
                        <label><input type="checkbox" name="opciones" value="alergias"> Alergias alimentarias</label><br>
                        <label><input type="checkbox" name="opciones" value="intolerancias"> Intolerancias alimentarias</label><br>
                        <label><input type="checkbox" name="opciones" value="deshidratacion"> Deshidratación</label><br>
                        <label><input type="checkbox" name="opciones" value="digestivos"> Problemas de digestión</label><br>
                        <h4>Cabello</h4>
                        <label><input type="checkbox" name="opciones" value="caida"> Caída del cabello</label><br>
                        <label><input type="checkbox" name="opciones" value="seco"> Cabello seco y quebradizo</label><br>
                        <label><input type="checkbox" name="opciones" value="grasoso"> Cabello grasoso</label><br>
                        <label><input type="checkbox" name="opciones" value="caspa"> Caspa</label><br>
                        <label><input type="checkbox" name="opciones" value="calor"> Cabello dañado por el calor</label><br>
                        <label><input type="checkbox" name="opciones" value="tenido"> Cabello teñido o decolorado</label><br>
                        <label><input type="checkbox" name="opciones" value="encrespado"> Cabello encrespado</label><br>
                        <label><input type="checkbox" name="opciones" value="alopecia"> Alopecia</label><br>
                        <h4>Piel</h4>
                        <label><input type="checkbox" name="opciones" value="acne"> Acné</label><br>
                        <label><input type="checkbox" name="opciones" value="seca"> Piel seca</label><br>
                        <label><input type="checkbox" name="opciones" value="grasosa"> Piel grasosa</label><br>
                        <label><input type="checkbox" name="opciones" value="hiperpigmentacion"> Hiperpigmentación</label><br>
                        <label><input type="checkbox" name="opciones" value="arrugas"> Arrugas y líneas finas</label><br>
                        <label><input type="checkbox" name="opciones" value="sensibilidad"> Sensibilidad en la piel</label><br>
                        <label><input type="checkbox" name="opciones" value="eccema"> Eccema</label><br>
                        <label><input type="checkbox" name="opciones" value="rosacea"> Rosácea</label><br>
                        <h5>Tipo de piel</h5>
                        <label><input type="radio" name="tipo_piel" value="normal"> Normal</label>
                        <label><input type="radio" name="tipo_piel" value="seca"> Seca</label>
                        <label><input type="radio" name="tipo_piel" value="grasosa"> Grasosa</label>
                        <label><input type="radio" name="tipo_piel" value="mixta"> Mixta</label>
                        <label><input type="radio" name="tipo_piel" value="sensible"> Sensible</label>
                        <br>
                        <button type="submit">Guardar cambios</button>
                    </form>
                    <p id="config-msg" style="color:green;display:none;">Preferencias actualizadas.</p>
                    <hr>
                    <h3>Opciones de cuenta</h3>
                    <button id="btn-cambiar-pass">Cambiar contraseña</button>
                    <div id="cambiar-pass-form" style="display:none;margin:1rem 0;">
                        <form>
                            <label>Contraseña actual:<br><input type="password" id="pass-actual" required></label><br>
                            <label>Nueva contraseña:<br><input type="password" id="pass-nueva" required></label><br>
                            <label>Repetir nueva contraseña:<br><input type="password" id="pass-nueva2" required></label><br>
                            <button type="submit">Guardar</button>
                            <span id="pass-msg" style="color:green;display:none;margin-left:1rem;">Contraseña cambiada</span>
                            <span id="pass-err" style="color:red;display:none;margin-left:1rem;"></span>
                        </form>
                    </div>
                    <button id="btn-notificaciones">Notificaciones</button>
                    <div id="notificaciones-form" style="display:none;margin:1rem 0;">
                        <form>
                            <label><input type="checkbox" id="notif-email"> Recibir notificaciones por email</label><br>
                            <label><input type="checkbox" id="notif-push"> Notificaciones push</label><br>
                            <button type="submit">Guardar</button>
                            <span id="notif-msg" style="color:green;display:none;margin-left:1rem;">Notificaciones actualizadas</span>
                        </form>
                    </div>
                    <button id="btn-privacidad">Privacidad</button>
                    <div id="privacidad-form" style="display:none;margin:1rem 0;">
                        <form>
                            <label><input type="checkbox" id="priv-perfil"> Perfil visible solo para mí</label><br>
                            <label><input type="checkbox" id="priv-reseñas"> Ocultar mis reseñas públicas</label><br>
                            <button type="submit">Guardar</button>
                            <span id="priv-msg" style="color:green;display:none;margin-left:1rem;">Privacidad actualizada</span>
                        </form>
                    </div>
                    <button id="btn-metodos-pago">Métodos de pago</button>
                    <div id="pago-form" style="display:none;margin:1rem 0;">
                        <form>
                            <label>Nueva tarjeta:<br><input type="text" id="pago-tarjeta" placeholder="**** **** **** 1234"></label><br>
                            <button type="submit">Guardar</button>
                            <span id="pago-msg" style="color:green;display:none;margin-left:1rem;">Método guardado</span>
                        </form>
                        <div id="pago-lista" style="margin-top:0.5rem;"></div>
                    </div>
                    <button id="btn-logout" style="background:#e53935;color:#fff;margin-top:1.5rem;">Cerrar sesión</button>
                </div>
            </section>
            <!-- Tienda personalizada -->
            <section id="tienda" class="main-section" style="display:none">
                <h2>Tienda personalizada</h2>
                <input type="text" id="busqueda-tienda" placeholder="Buscar producto..." style="width: 100%; padding: 0.5rem; border-radius: 4px; border: 1px solid #ccc; margin-bottom: 1rem;" />
                <div id="productos-tienda"></div>
            </section>
            <!-- Carrito de compras -->
            <section id="carrito" class="main-section" style="display:none">
                <h2>Carrito de compras</h2>
                <div id="carrito-lista"></div>
                <div id="carrito-total" style="margin:1rem 0;"></div>
                <button id="btn-comprar" style="display:none;">Comprar</button>
                <div id="compra-form" style="display:none; margin-top:1.5rem;">
                    <h3>Datos para la compra</h3>
                    <form id="form-compra">
                        <label>Nombre completo:<br><input type="text" id="compra-nombre" required></label><br>
                        <label>Dirección:<br><input type="text" id="compra-direccion" required></label><br>
                        <label>Email:<br><input type="email" id="compra-email" required></label><br>
                        <label>Método de pago:<br>
                            <select id="compra-pago" required>
                                <option value="tarjeta">Tarjeta de crédito/débito</option>
                                <option value="paypal">PayPal</option>
                                <option value="transferencia">Transferencia bancaria</option>
                            </select>
                        </label><br>
                        <button type="submit">Finalizar compra</button>
                    </form>
                    <div id="compra-exito" style="color:green;display:none;margin-top:1rem;">¡Compra realizada con éxito!</div>
                </div>
            </section>
            <section id="perfil" class="main-section" style="display:none">
                <h2>Perfil</h2>
                <div id="perfil-info" style="display:flex;align-items:center;gap:2rem;">
                    <div>
                        <img id="perfil-foto" src="https://ui-avatars.com/api/?name=Usuario" alt="Foto de perfil" style="width:100px;height:100px;border-radius:50%;object-fit:cover;border:2px solid #4caf50;">
                        <input type="file" id="cambiar-foto" accept="image/*" style="display:block;margin-top:0.5rem;">
                    </div>
                    <div>
                        <p><b>Usuario:</b> <span id="perfil-usuario"></span></p>
                        <p><b>Nombre:</b> <span id="perfil-nombre"></span></p>
                        <p><b>Email:</b> <span id="perfil-email"></span></p>
                    </div>
                </div>
                <div id="perfil-defectos" style="margin-top:2rem;background:#f7f7f7;padding:1rem;border-radius:8px;max-width:400px;">
                    <h3 style="margin-top:0;">Mis defectos (solo tú puedes ver esto)</h3>
                    <textarea id="defectos-text" placeholder="Escribe aquí tus defectos personales..." style="width:100%;min-height:60px;border-radius:4px;border:1px solid #ccc;padding:0.5rem;"></textarea>
                    <button id="guardar-defectos" style="margin-top:0.7rem;">Guardar</button>
                    <span id="defectos-msg" style="color:green;display:none;margin-left:1rem;">Guardado</span>
                </div>
                <div id="perfil-publicaciones" style="margin-top:2rem;"></div>
                <div id="seguidores" style="margin-top:1rem;"></div>
                <div id="perfil-bio" style="margin-top:1rem;"></div>
            </section>
            <section id="feed-recomendaciones" class="main-section" style="display:none">
                <h2>Recomendaciones para ti</h2>
                <div id="recomendaciones-lista"></div>
            </section>
            <!-- Sección Proveedores -->
            <section id="proveedores" class="main-section" style="display:none">
                <h2>Proveedores</h2>
                <div class="proveedores-lista">
                    <p>Consulta y gestiona los proveedores asociados a los productos.</p>
                    <div class="placeholder">(Próximamente: gestión avanzada de proveedores)</div>
                </div>
            </section>
            <!-- Sección Favoritos y Rutinas (unificada) -->
            <section id="favoritos-rutinas" class="main-section" style="display:none">
                <h2>Favoritos y Rutinas</h2>
                <div class="favoritos-lista">
                    <p>Descubre, guarda y organiza tus productos, rutinas o publicaciones favoritas.</p>
                    <div class="placeholder">(Próximamente: gestión avanzada de favoritos y rutinas)</div>
                </div>
                <div class="rutinas-lista">
                    <p>Organiza y consulta tus rutinas de cuidado personal favoritas.</p>
                    <div class="placeholder">(Próximamente: gestión avanzada de favoritos y rutinas)</div>
                </div>
            </section>
            <!-- Buscador global -->
            <section id="buscador" class="main-section" style="display:none">
                <h2>Buscador global</h2>
                <input type="text" id="busqueda-global" placeholder="Buscar usuarios, productos, rutinas o recetas..." style="width:100%;padding:0.5rem;border-radius:4px;border:1px solid #ccc;margin-bottom:1rem;" />
                <div id="resultados-global"></div>
            </section>
        </main>
        <footer>
            <p>&copy; 2025 florecer</p>
        </footer>
    </div>
    <script>
    // Autenticación simple con localStorage
    const authContainer = document.getElementById('auth-container');
    const mainContent = document.getElementById('main-content');
    const loginForm = document.getElementById('login-form');
    const registerForm = document.getElementById('register-form');
    const showRegister = document.getElementById('show-register');
    const showLogin = document.getElementById('show-login');
    const loginError = document.getElementById('login-error');
    const registerError = document.getElementById('register-error');
    const personalizaPanel = document.getElementById('personaliza_panel');
    const continuarBtn = document.getElementById('continuar-btn');
    const registerFormEl = document.querySelector('#register-form form');

    // Mostrar registro
    showRegister.onclick = function(e) {
        e.preventDefault();
        loginForm.style.display = 'none';
        registerForm.style.display = 'block';
        loginError.style.display = 'none';
    };
    // Mostrar login
    showLogin.onclick = function(e) {
        e.preventDefault();
        registerForm.style.display = 'none';
        loginForm.style.display = 'block';
        registerError.style.display = 'none';
    };
    // Guardar usuario (solo validación, NO guardar en localStorage aquí)
    registerFormEl.onsubmit = function(e) {
        e.preventDefault();
        // Permitir registro sin datos reales durante 2 minutos
        const testMode = localStorage.getItem('test_registro') === 'true';
        const ahora = Date.now();
        const testExpira = parseInt(localStorage.getItem('test_registro_expira') || '0');
        if (!testMode || ahora > testExpira) {
            // Activar modo test por 2 minutos
            localStorage.setItem('test_registro', 'true');
            localStorage.setItem('test_registro_expira', (ahora + 2*60*1000).toString());
        }
        let nombre = document.getElementById('register-nombre').value;
        let apellidos = document.getElementById('register-apellidos').value;
        let usuario = document.getElementById('register-user').value;
        let email = document.getElementById('register-email').value;
        let password = document.getElementById('register-password').value;
        let password2 = document.getElementById('register-password2').value;
        if(localStorage.getItem('test_registro') === 'true' && Date.now() < parseInt(localStorage.getItem('test_registro_expira'))) {
            // Rellenar datos falsos si están vacíos
            nombre = nombre || 'Test';
            apellidos = apellidos || 'Usuario';
            usuario = usuario || 'testuser' + Math.floor(Math.random()*10000);
            email = email || 'test'+Math.floor(Math.random()*10000)+'@mail.com';
            password = password || '1234';
            password2 = password2 || '1234';
        }
        if(password !== password2) {
            document.getElementById('register-error').textContent = 'Las contraseñas no coinciden.';
            document.getElementById('register-error').style.display = 'block';
            return;
        }
        if(localStorage.getItem('user_' + usuario)) {
            document.getElementById('register-error').textContent = 'El usuario ya existe.';
            document.getElementById('register-error').style.display = 'block';
            return;
        }
        // Guardar datos temporalmente en memoria (no en localStorage)
        window._registroTemporal = {nombre, apellidos, usuario, email, password};
        document.getElementById('register-error').style.display = 'none';
        document.getElementById('register-form').style.display = 'none';
        personalizaPanel.style.display = 'block';
    };
    // Guardar preferencias por categoría y guardar usuario en localStorage aquí
    personalizaPanel.querySelector('form').onsubmit = function(e) {
        e.preventDefault();
        const temp = window._registroTemporal;
        if (!temp) return;
        const nutricion = Array.from(document.querySelectorAll('input[name="nutricion"]:checked')).map(cb => cb.value);
        const cabello = Array.from(document.querySelectorAll('input[name="cabello"]:checked')).map(cb => cb.value);
        const piel = Array.from(document.querySelectorAll('input[name="piel"]:checked')).map(cb => cb.value);
        const tipoPiel = document.querySelector('input[name="tipo_piel"]:checked')?.value || '';
        let userData = {...temp, nutricion, cabello, piel, tipoPiel};
        localStorage.setItem('user_' + temp.usuario, JSON.stringify(userData));
        personalizaPanel.style.display = 'none';
        document.getElementById('auth-container').style.display = 'none';
        document.getElementById('main-content').style.display = 'block';
        setLoggedIn(temp.usuario);
        mostrarContenidoPersonalizado(userData);
        delete window._registroTemporal;
    };
    // Mostrar contenido personalizado según categorías
    function mostrarContenidoPersonalizado(userData) {
        // Oculta todas las secciones
        document.querySelectorAll('.main-section').forEach(sec => sec.style.display = 'none');
        // Nutrición
        if(userData.nutricion) {
            userData.nutricion.forEach(tipo => {
                const sec = document.getElementById('nutricion-' + tipo);
                if(sec) sec.style.display = 'block';
            });
        }
        // Cabello
        if(userData.cabello) {
            userData.cabello.forEach(tipo => {
                const sec = document.getElementById('cabello-' + tipo);
                if(sec) sec.style.display = 'block';
            });
        }
        // Piel
        if(userData.piel) {
            userData.piel.forEach(tipo => {
                const sec = document.getElementById('piel-' + tipo);
                if(sec) sec.style.display = 'block';
            });
        }
        // Si no seleccionó nada, mostrar inicio por defecto
        if((!userData.nutricion || userData.nutricion.length === 0) && (!userData.cabello || userData.cabello.length === 0) && (!userData.piel || userData.piel.length === 0)) {
            document.getElementById('inicio').style.display = 'block';
        }
    }
    // Iniciar sesión
    loginForm.querySelector('form').onsubmit = function(e) {
        e.preventDefault();
        const userInput = document.getElementById('login-user').value.trim();
        const password = document.getElementById('login-password').value;
        const keepLogged = document.getElementById('keep-logged').checked;
        let usuario = null;
        // Buscar por usuario o email
        for(let key in localStorage) {
            if(key.startsWith('user_')) {
                const data = JSON.parse(localStorage.getItem(key));
                if(data && (data.usuario === userInput || data.email === userInput)) {
                    usuario = data.usuario;
                    if(data.password !== password) usuario = null;
                    break;
                }
            }
        }
        if(usuario) {
            loginError.style.display = 'none';
            authContainer.style.display = 'none';
            mainContent.style.display = 'block';
            if(keepLogged) {
                localStorage.setItem('keepLogged', 'true');
                setLoggedIn(usuario);
            } else {
                localStorage.removeItem('keepLogged');
                setLoggedIn(usuario);
            }
        } else {
            loginError.textContent = 'Usuario, email o contraseña incorrectos.';
            loginError.style.display = 'block';
        }
    };
    // Al cargar, si keepLogged está activo, mostrar página principal
    window.onload = function() {
        // Siempre mostrar solo el login al cargar
        document.getElementById('auth-container').style.display = 'block';
        document.getElementById('login-form').style.display = 'block';
        document.getElementById('register-form').style.display = 'none';
        document.getElementById('main-content').style.display = 'none';
        if(document.getElementById('personaliza_panel')) document.getElementById('personaliza_panel').style.display = 'none';
        // Si keepLogged está activo, mostrar página principal
        const keepLogged = localStorage.getItem('keepLogged') === 'true';
        const loggedUser = localStorage.getItem('loggedUser');
        if(keepLogged && loggedUser && localStorage.getItem('user_' + loggedUser)) {
            document.getElementById('auth-container').style.display = 'none';
            document.getElementById('main-content').style.display = 'block';
        }
        inicializarSeccionesPropias();
    };
    // Guardar estado de login
    function setLoggedIn(usuario) {
        localStorage.setItem('loggedIn', 'true');
        localStorage.setItem('loggedUser', usuario);
    }
    // --- Lógica de navegación horizontal ---
    document.querySelectorAll('.nav-link').forEach(btn => {
        btn.addEventListener('click', function(e) {
            e.preventDefault();
            document.querySelectorAll('.main-section').forEach(sec => sec.style.display = 'none');
            const sec = document.getElementById(this.dataset.section);
            if(sec) sec.style.display = 'block';
            if(this.dataset.section === 'tienda') {
                const usuario = localStorage.getItem('loggedUser');
                const userData = JSON.parse(localStorage.getItem('user_' + usuario));
                mostrarTiendaPersonalizada(userData);
            }
            if(this.dataset.section === 'carrito') {
                renderCarrito();
            }
            if(this.dataset.section === 'perfil') {
                cargarPerfil();
            }
            if(this.dataset.section === 'feed-recomendaciones') {
                const usuario = localStorage.getItem('loggedUser');
                const userData = JSON.parse(localStorage.getItem('user_' + usuario));
                mostrarFeedRecomendaciones(userData);
            }
        });
    });
    // Mostrar preferencias actuales en configuración
    function cargarPreferenciasConfiguracion() {
        const usuario = localStorage.getItem('loggedUser');
        if (!usuario) return;
        const userData = JSON.parse(localStorage.getItem('user_' + usuario));
        if (!userData || !userData.opciones) return;
        const form = document.getElementById('edit-preferencias-form');
        form.querySelectorAll('input[name="opciones"]').forEach(cb => {
            cb.checked = userData.opciones.includes(cb.value);
        });
    }
    // Guardar cambios de preferencias
    const editForm = document.getElementById('edit-preferencias-form');
    if(editForm) {
        editForm.onsubmit = function(e) {
            e.preventDefault();
            const usuario = localStorage.getItem('loggedUser');
            let userData = JSON.parse(localStorage.getItem('user_' + usuario));
            const opciones = Array.from(editForm.querySelectorAll('input[name="opciones"]:checked')).map(cb => cb.value);
            userData.opciones = opciones;
            localStorage.setItem('user_' + usuario, JSON.stringify(userData));
            document.getElementById('config-msg').style.display = 'block';
            mostrarContenidoPersonalizado(opciones);
            setTimeout(()=>{
                document.getElementById('config-msg').style.display = 'none';
            }, 2000);
        };
    }
    // Cuando se muestre la sección configuración, cargar preferencias
    const configSection = document.getElementById('configuracion');
    if(configSection) {
        const observer = new MutationObserver(() => {
            if (configSection.style.display === 'block') {
                cargarPreferenciasConfiguracion();
            }
        });
        observer.observe(configSection, { attributes: true, attributeFilter: ['style'] });
    }
    // --- Unificación de productos/tienda ---
    // Eliminar sección 'productos' y dejar solo 'tienda', mostrar todos los productos vendibles con buscador, reseñas, calificación y botón de añadir al carrito/pedidos.
    // --- Unificación de carrito/pedidos ---
    // Eliminar sección 'pedidos' y dejar solo 'carrito', mostrar compras actuales, historial y estado.
    // --- Mejorar perfil IG/FB/TikTok ---
    // Añadir biografía editable, seguidores/seguidos, publicaciones propias, guardadas, rutinas y recetas.
    // (Definición ÚNICA de cargarPerfil)
    function cargarPerfil() {
        const usuario = localStorage.getItem('loggedUser');
        if (!usuario) return;
        const userData = JSON.parse(localStorage.getItem('user_' + usuario));
        document.getElementById('perfil-usuario').textContent = userData.usuario || '';
        document.getElementById('perfil-nombre').textContent = userData.nombre || '';
        document.getElementById('perfil-email').textContent = userData.email || '';
        // Foto de perfil
        const foto = userData.fotoPerfil || `https://ui-avatars.com/api/?name=${encodeURIComponent(userData.nombre||userData.usuario)}`;
        document.getElementById('perfil-foto').src = foto;
        // Biografía editable
        let bio = userData.bio || '';
        let bioDiv = document.getElementById('perfil-bio');
        if(!bioDiv) {
            bioDiv = document.createElement('div');
            bioDiv.id = 'perfil-bio';
            document.getElementById('perfil-info').appendChild(bioDiv);
        }
        bioDiv.innerHTML = bio + ' <button id="editar-bio-btn">Editar biografía</button>';
        document.getElementById('editar-bio-btn').onclick = function() {
            const nuevoBio = prompt('Edita tu biografía:', bio);
            if(nuevoBio !== null) {
                userData.bio = nuevoBio;
                localStorage.setItem('user_' + usuario, JSON.stringify(userData));
                cargarPerfil();
            }
        };
        // Seguidores/seguidos (simulado)
        let seguidores = userData.seguidores || Math.floor(Math.random()*100+10);
        let seguidos = userData.seguidos || Math.floor(Math.random()*50+5);
        let segDiv = document.getElementById('seguidores');
        if(!segDiv) {
            segDiv = document.createElement('span');
            segDiv.id = 'seguidores';
            document.getElementById('perfil-info').appendChild(segDiv);
        }
        segDiv.textContent = seguidores + ' seguidores';
        let seg2Div = document.getElementById('seguidos');
        if(!seg2Div) {
            seg2Div = document.createElement('span');
            seg2Div.id = 'seguidos';
            document.getElementById('perfil-info').appendChild(seg2Div);
        }
        seg2Div.textContent = seguidos + ' seguidos';
        // Defectos personales (solo local)
        document.getElementById('defectos-text').value = userData.defectos || '';
    }
    // --- Menú lateral hamburguesa ---
    document.getElementById('menuBtn').innerHTML = '<span style="font-size:2em;line-height:1;">&#9776;</span>';
    // --- Mejorar experiencia visual y responsiva ---
    // (Ya implementado en CSS, solo asegurar que las clases y elementos estén presentes y bien estructurados)
    // --- Datos de productos personalizados ---
    const productosTienda = [
        {categoria: 'nutricion', sub: 'deficiencias', nombre: 'Centrum Multivitamínico', precio: 15, marca: 'Centrum', descripcion: 'Suplemento vitamínico y mineral para cubrir deficiencias.', id: 'cent1', imagen: 'https://m.media-amazon.com/images/I/61QwQwQwQwL._AC_SY355_.jpg'},
        {categoria: 'nutricion', sub: 'deficiencias', nombre: 'Ensure Nutrición Enteral', precio: 30, marca: 'Ensure', descripcion: 'Bebida nutricional para necesidades especiales.', id: 'ens1', imagen: 'https://m.media-amazon.com/images/I/71QwQwQwQwL._AC_SY355_.jpg'},
        {categoria: 'nutricion', sub: 'sobrepeso', nombre: 'SlimFast Batido', precio: 20, marca: 'SlimFast', descripcion: 'Batido para control de peso y nutrición equilibrada.', id: 'slim1', imagen: 'https://m.media-amazon.com/images/I/81QwQwQwQwL._AC_SY355_.jpg'},
        {categoria: 'cabello', sub: 'caida', nombre: 'Nioxin Shampoo', precio: 25, marca: 'Nioxin', descripcion: 'Champú para fortalecer y estimular el crecimiento del cabello.', id: 'niox1', imagen: 'https://m.media-amazon.com/images/I/51QwQwQwQwL._AC_SY355_.jpg'},
        {categoria: 'cabello', sub: 'caspa', nombre: 'Head & Shoulders Anticaspa', precio: 12, marca: 'Head & Shoulders', descripcion: 'Champú para eliminar la caspa y aliviar la picazón.', id: 'hs1', imagen: 'https://m.media-amazon.com/images/I/61QwQwQwQwL._AC_SY355_.jpg'},
        {categoria: 'cabello', sub: 'seco', nombre: 'Moroccanoil Mascarilla', precio: 22, marca: 'Moroccanoil', descripcion: 'Mascarilla hidratante para cabello seco y dañado.', id: 'moro1', imagen: 'https://m.media-amazon.com/images/I/71QwQwQwQwL._AC_SY355_.jpg'}
        // ...agrega más productos según lo personalizado...
    ];
    // --- Mostrar productos personalizados según usuario ---
    function mostrarTiendaPersonalizada(userData) {
        document.querySelectorAll('.main-section').forEach(sec => sec.style.display = 'none');
        document.getElementById('tienda').style.display = 'block';
        const cont = document.getElementById('productos-tienda');
        cont.innerHTML = '';
        let productos = [];
        if(userData.nutricion) {
            userData.nutricion.forEach(sub => {
                productos = productos.concat(productosTienda.filter(p => p.categoria==='nutricion' && p.sub===sub));
            });
        }
        if(userData.cabello) {
            userData.cabello.forEach(sub => {
                productos = productos.concat(productosTienda.filter(p => p.categoria==='cabello' && p.sub===sub));
            });
        }
        // Mostrar todos los productos si no hay preferencias
        if(productos.length === 0) {
            productos = productosTienda;
        }
        if(productos.length === 0) {
            cont.innerHTML = '<p>No hay productos personalizados para tus preferencias.</p>';
        } else {
            productos.forEach(prod => {
                cont.innerHTML += renderProducto(prod);
            });
        }
        cargarResenas();
    }
    // Mostrar tienda automáticamente al entrar en la sección tienda
    const tiendaSection = document.getElementById('tienda');
    if(tiendaSection) {
        const observerTienda = new MutationObserver(() => {
            if (tiendaSection.style.display === 'block') {
                const usuario = localStorage.getItem('loggedUser');
                const userData = JSON.parse(localStorage.getItem('user_' + usuario));
                mostrarTiendaPersonalizada(userData);
            }
        });
        observerTienda.observe(tiendaSection, { attributes: true, attributeFilter: ['style'] });
    }
    // --- Carrito de compras ---
    let carrito = JSON.parse(localStorage.getItem('carrito') || '[]');
    function renderCarrito() {
        document.querySelectorAll('.main-section').forEach(sec => sec.style.display = 'none');
        document.getElementById('carrito').style.display = 'block';
        const lista = document.getElementById('carrito-lista');
        if(carrito.length === 0) {
            lista.innerHTML = '<p>Tu carrito está vacío.</p>';
            document.getElementById('carrito-total').textContent = '';
            document.getElementById('btn-comprar').style.display = 'none';
            return;
        }
        lista.innerHTML = carrito.map((item, i) =>
            `<div class="carrito-item">
                <b>${item.nombre}</b> (${item.marca}) - $${item.precio} <button onclick="eliminarDelCarrito(${i})">Eliminar</button>
            </div>`
        ).join('');
        const total = carrito.reduce((sum, item) => sum + item.precio, 0);
        document.getElementById('carrito-total').textContent = 'Total: $' + total;
        document.getElementById('btn-comprar').style.display = 'inline-block';
    }
    function eliminarDelCarrito(idx) {
        carrito.splice(idx, 1);
        localStorage.setItem('carrito', JSON.stringify(carrito));
        renderCarrito();
    }
    // --- Añadir a carrito desde tienda ---
    function agregarAlCarrito(prod) {
        carrito.push(prod);
        localStorage.setItem('carrito', JSON.stringify(carrito));
        alert('Producto añadido al carrito');
    }
    // Modificar renderProducto para mostrar imagen y precio destacado
    function renderProducto(prod) {
        const imagen = prod.imagen || 'https://via.placeholder.com/120x120?text=Producto';
        return `<div class="producto" data-id="${prod.id}" style="display:flex;align-items:center;gap:1.5rem;margin-bottom:1.5rem;">
            <img src="${imagen}" alt="${prod.nombre}" style="width:120px;height:120px;object-fit:cover;border-radius:10px;border:1px solid #ccc;">
            <div style="flex:1;">
                <h3 style="margin:0 0 0.3em 0;">${prod.nombre} <span style="font-size:0.9em;color:#888;">(${prod.marca})</span></h3>
                <p style="margin:0 0 0.5em 0;">${prod.descripcion}</p>
                <p style="font-size:1.2em;color:#388e3c;"><b>Precio:</b> $${prod.precio}</p>
                <button class="btn-carrito">Añadir al carrito</button>
                <div class="calificacion">
                    <span>Califica:</span> ${[1,2,3,4,5].map(n=>`<span class="estrella" data-valor="${n}">&#9733;</span>`).join('')}
                    <span class="promedio"></span>
                </div>
                <div class="resenas">
                    <h4>Reseñas</h4>
                    <div class="lista-resenas"></div>
                    <textarea class="nueva-resena" placeholder="Escribe tu reseña..."></textarea>
                    <button class="btn-resena">Enviar reseña</button>
                </div>
            </div>
        </div><hr>`;
    }
    // Delegar evento para añadir al carrito
    function cargarResenas() {
        document.querySelectorAll('.producto').forEach(prodDiv => {
            const id = prodDiv.dataset.id;
            // Calificación
            const estrellas = prodDiv.querySelectorAll('.estrella');
            const promedioSpan = prodDiv.querySelector('.promedio');
            let calificaciones = JSON.parse(localStorage.getItem('calif_' + id) || '[]');
            let promedio = calificaciones.length ? (calificaciones.reduce((a,b)=>a+b,0)/calificaciones.length).toFixed(1) : '-';
            promedioSpan.textContent = `(${promedio}/5)`;
            estrellas.forEach((star, idx) => {
                star.onclick = function() {
                    calificaciones.push(idx+1);
                    localStorage.setItem('calif_' + id, JSON.stringify(calificaciones));
                    cargarResenas();
                };
            });
            // Reseñas
            const lista = prodDiv.querySelector('.lista-resenas');
            let resenas = JSON.parse(localStorage.getItem('resenas_' + id) || '[]');
            lista.innerHTML = resenas.map(r => `<div class="resena">${r}</div>`).join('');
            prodDiv.querySelector('.btn-resena').onclick = function() {
                const txt = prodDiv.querySelector('.nueva-resena').value.trim();
                if(txt) {
                    resenas.push(txt);
                    localStorage.setItem('resenas_' + id, JSON.stringify(resenas));
                    cargarResenas();
                }
            };
            // Añadir al carrito
            prodDiv.querySelector('.btn-carrito').onclick = function() {
                const prod = productosTienda.find(p => p.id === id);
                agregarAlCarrito(prod);
            };
        });
    }
    // --- Comprar ---
    document.getElementById('btn-comprar').onclick = function() {
        document.getElementById('compra-form').style.display = 'block';
    };
    document.getElementById('form-compra').onsubmit = function(e) {
        e.preventDefault();
        carrito = [];
        localStorage.setItem('carrito', '[]');
        renderCarrito();
        document.getElementById('compra-exito').style.display = 'block';
        setTimeout(()=>{
            document.getElementById('compra-exito').style.display = 'none';
            document.getElementById('compra-form').style.display = 'none';
        }, 2000);
    };
    // --- Acceso a carrito desde menú ---
    document.querySelectorAll('.side-link').forEach(btn => {
        if(btn.dataset.section === 'carrito') {
            btn.addEventListener('click', function() {
                renderCarrito();
            });
        }
    });
    // --- Bienvenida usuario ---
    function mostrarBienvenidaUsuario() {
        const usuario = localStorage.getItem('loggedUser');
        if (!usuario) return;
        const userData = JSON.parse(localStorage.getItem('user_' + usuario));
        if (userData && userData.nombre) {
            document.getElementById('bienvenida-usuario').innerHTML = `¡Bienvenido/a, <span style="color:#388e3c;">${userData.nombre}</span>!`;
        } else {
            document.getElementById('bienvenida-usuario').textContent = 'Inicio';
        }
    }
    // Llamar al mostrarBienvenidaUsuario cuando se muestre la sección de inicio
    const inicioSection = document.getElementById('inicio');
    if(inicioSection) {
        const observerInicio = new MutationObserver(() => {
            if (inicioSection.style.display === 'block') {
                mostrarBienvenidaUsuario();
            }
        });
        observerInicio.observe(inicioSection, { attributes: true, attributeFilter: ['style'] });
    }
    // --- Cargar perfil ---
    function cargarPerfil() {
        const usuario = localStorage.getItem('loggedUser');
        if (!usuario) return;
        const userData = JSON.parse(localStorage.getItem('user_' + usuario));
        document.getElementById('perfil-usuario').textContent = userData.usuario || '';
        document.getElementById('perfil-nombre').textContent = userData.nombre || '';
        document.getElementById('perfil-email').textContent = userData.email || '';
        // Foto de perfil
        const foto = userData.fotoPerfil || `https://ui-avatars.com/api/?name=${encodeURIComponent(userData.nombre||userData.usuario)}`;
        document.getElementById('perfil-foto').src = foto;
        // Biografía editable
        let bio = userData.bio || '';
        let bioDiv = document.getElementById('perfil-bio');
        if(!bioDiv) {
            bioDiv = document.createElement('div');
            bioDiv.id = 'perfil-bio';
            document.getElementById('perfil-info').appendChild(bioDiv);
        }
        bioDiv.innerHTML = bio + ' <button id="editar-bio-btn">Editar biografía</button>';
        document.getElementById('editar-bio-btn').onclick = function() {
            const nuevoBio = prompt('Edita tu biografía:', bio);
            if(nuevoBio !== null) {
                userData.bio = nuevoBio;
                localStorage.setItem('user_' + usuario, JSON.stringify(userData));
                cargarPerfil();
            }
        };
        // Seguidores/seguidos (simulado)
        let seguidores = userData.seguidores || Math.floor(Math.random()*100+10);
        let seguidos = userData.seguidos || Math.floor(Math.random()*50+5);
        let segDiv = document.getElementById('seguidores');
        if(!segDiv) {
            segDiv = document.createElement('span');
            segDiv.id = 'seguidores';
            document.getElementById('perfil-info').appendChild(segDiv);
        }
        segDiv.textContent = seguidores + ' seguidores';
        let seg2Div = document.getElementById('seguidos');
        if(!seg2Div) {
            seg2Div = document.createElement('span');
            seg2Div.id = 'seguidos';
            document.getElementById('perfil-info').appendChild(seg2Div);
        }
        seg2Div.textContent = seguidos + ' seguidos';
        // Defectos personales (solo local)
        document.getElementById('defectos-text').value = userData.defectos || '';
    }
    // Guardar defectos
    const defectosBtn = document.getElementById('guardar-defectos');
    if(defectosBtn) {
        defectosBtn.onclick = function() {
            const usuario = localStorage.getItem('loggedUser');
            let userData = JSON.parse(localStorage.getItem('user_' + usuario));
            userData.defectos = document.getElementById('defectos-text').value;
            localStorage.setItem('user_' + usuario, JSON.stringify(userData));
            document.getElementById('defectos-msg').style.display = 'inline';
            setTimeout(()=>{
                document.getElementById('defectos-msg').style.display = 'none';
            }, 1500);
        };
    }
    // Cambiar foto de perfil
    const cambiarFoto = document.getElementById('cambiar-foto');
    if(cambiarFoto) {
        cambiarFoto.onchange = function(e) {
            const file = e.target.files[0];
            if(file) {
                const reader = new FileReader();
                reader.onload = function(evt) {
                    document.getElementById('perfil-foto').src = evt.target.result;
                    const usuario = localStorage.getItem('loggedUser');
                    let userData = JSON.parse(localStorage.getItem('user_' + usuario));
                    userData.fotoPerfil = evt.target.result;
                    localStorage.setItem('user_' + usuario, JSON.stringify(userData));
                };
                reader.readAsDataURL(file);
            }
        };
    }
    // Mostrar perfil al entrar en la sección
    const perfilSection = document.getElementById('perfil');
    if(perfilSection) {
        const observerPerfil = new MutationObserver(() => {
            if (perfilSection.style.display === 'block') {
                cargarPerfil();
            }
        });
        observerPerfil.observe(perfilSection, { attributes: true, attributeFilter: ['style'] });
    }
    // Mostrar recomendaciones en el feed según selección personalizada
    function mostrarFeedRecomendaciones(userData) {
        document.querySelectorAll('.main-section').forEach(sec => sec.style.display = 'none');
        document.getElementById('feed-recomendaciones').style.display = 'block';
        const lista = document.getElementById('recomendaciones-lista');
        let recomendaciones = [];
        // Nutrición
        if(userData.nutricion) {
            if(userData.nutricion.includes('deficiencias')) recomendaciones.push('Incluye más frutas, verduras y proteínas magras en tu dieta diaria.');
            if(userData.nutricion.includes('sobrepeso')) recomendaciones.push('Haz ejercicio regularmente y controla las porciones de tus comidas.');
            if(userData.nutricion.includes('desnutricion')) recomendaciones.push('Consulta a un nutricionista para un plan alimenticio personalizado.');
            if(userData.nutricion.includes('alergias')) recomendaciones.push('Lee siempre las etiquetas de los alimentos y evita los alérgenos.');
            if(userData.nutricion.includes('intolerancias')) recomendaciones.push('Prueba una dieta de eliminación para identificar alimentos problemáticos.');
            if(userData.nutricion.includes('deshidratacion')) recomendaciones.push('Bebe agua frecuentemente y consume frutas hidratantes.');
            if(userData.nutricion.includes('digestivos')) recomendaciones.push('Incluye fibra y probióticos en tu dieta para mejorar la digestión.');
        }
        // Cabello
        if(userData.cabello) {
            if(userData.cabello.includes('caida')) recomendaciones.push('Reduce el estrés y usa productos que fortalezcan el cabello.');
            if(userData.cabello.includes('seco')) recomendaciones.push('Utiliza mascarillas hidratantes y evita el calor excesivo.');
            if(userData.cabello.includes('grasoso')) recomendaciones.push('Lava tu cabello con productos específicos para controlar el sebo.');
            if(userData.cabello.includes('caspa')) recomendaciones.push('Usa champús anticaspa y mantén una buena higiene.');
            if(userData.cabello.includes('calor')) recomendaciones.push('Protege tu cabello antes de usar planchas o secadores.');
            if(userData.cabello.includes('tenido')) recomendaciones.push('Usa productos especiales para cabello teñido y evita lavados frecuentes.');
            if(userData.cabello.includes('encrespado')) recomendaciones.push('Aplica aceites naturales y productos anti-frizz.');
            if(userData.cabello.includes('alopecia')) recomendaciones.push('Consulta a un especialista para un tratamiento adecuado.');
        }
        // Piel
        if(userData.piel) {
            if(userData.piel.includes('acne')) recomendaciones.push('Limpia tu rostro dos veces al día y usa productos antiacné.');
            if(userData.piel.includes('seca')) recomendaciones.push('Hidrata tu piel con cremas nutritivas y evita jabones agresivos.');
            if(userData.piel.includes('grasosa')) recomendaciones.push('Usa productos oil-free y realiza exfoliaciones suaves.');
            if(userData.piel.includes('hiperpigmentacion')) recomendaciones.push('Aplica protector solar y productos con vitamina C.');
            if(userData.piel.includes('arrugas')) recomendaciones.push('Utiliza cremas antiedad y productos con retinoides.');
            if(userData.piel.includes('sensibilidad')) recomendaciones.push('Prefiere productos hipoalergénicos y sin fragancia.');
            if(userData.piel.includes('eccema')) recomendaciones.push('Usa cremas emolientes y evita alérgenos.');
            if(userData.piel.includes('rosacea')) recomendaciones.push('Evita irritantes y consulta a un dermatólogo.');
        }
        // Tipo de piel
        if(userData.tipoPiel) {
            recomendaciones.push('Tu tipo de piel es: ' + userData.tipoPiel.charAt(0).toUpperCase() + userData.tipoPiel.slice(1));
        }
        if(recomendaciones.length === 0) {
            lista.innerHTML = '<p>No hay recomendaciones personalizadas. Selecciona tus opciones en el registro.</p>';
        } else {
            lista.innerHTML = recomendaciones.map(r => `<div class="reco">${r}</div>`).join('');
        }
    }
    // Mostrar recomendaciones al entrar en el feed
    const feedSection = document.getElementById('feed-recomendaciones');
    if(feedSection) {
        const observerFeed = new MutationObserver(() => {
            if (feedSection.style.display === 'block') {
                const usuario = localStorage.getItem('loggedUser');
                const userData = JSON.parse(localStorage.getItem('user_' + usuario));
                mostrarFeedRecomendaciones(userData);
            }
        });
        observerFeed.observe(feedSection, { attributes: true, attributeFilter: ['style'] });
    }
    // --- Buscador global interactivo ---
    // (modificar el buscador para incluir datos de cuidado personal)
    const buscadorSection = document.getElementById('buscador');
    const busquedaGlobal = document.createElement('input');
    busquedaGlobal.type = 'text';
    busquedaGlobal.id = 'busqueda-global';
    busquedaGlobal.placeholder = 'Buscar usuarios, productos, rutinas, recetas o información de cuidado personal...';
    const resultadosGlobal = document.createElement('div');
    resultadosGlobal.id = 'resultados-global';
    if(buscadorSection) {
        buscadorSection.appendChild(busquedaGlobal);
        buscadorSection.appendChild(resultadosGlobal);
        busquedaGlobal.addEventListener('input', function() {
            const val = this.value.toLowerCase();
            let html = '';
            // Buscar usuarios
            const usuarios = Object.keys(localStorage)
                .filter(k => k.startsWith('user_'))
                .map(k => JSON.parse(localStorage.getItem(k)));
            const usuariosFiltrados = usuarios.filter(u => u.usuario.toLowerCase().includes(val) || (u.nombre && u.nombre.toLowerCase().includes(val)));
            if(usuariosFiltrados.length) {
                html += '<h3>Usuarios</h3><ul>' + usuariosFiltrados.map(u => `<li><b>${u.usuario}</b> <button onclick="verPerfilBuscado('${u.usuario}')">Ver perfil</button></li>`).join('') + '</ul>';
            }
            // Buscar productos
            const productosFiltrados = productosTienda.filter(p => p.nombre.toLowerCase().includes(val) || p.marca.toLowerCase().includes(val) || p.descripcion.toLowerCase().includes(val));
            if(productosFiltrados.length) {
                html += '<h3>Productos</h3>' + productosFiltrados.map(p => `<div class="producto" data-id="${p.id}">${renderProducto(p)}</div>`).join('');
            }
            // Buscar datos de cuidado personal
            const datosFiltrados = datosCuidadoPersonal.filter(d =>
                d.nombre.toLowerCase().includes(val) ||
                d.categoria.toLowerCase().includes(val) ||
                d.problemas.toLowerCase().includes(val) ||
                d.soluciones.toLowerCase().includes(val) ||
                d.productos.toLowerCase().includes(val) ||
                d.marcas.toLowerCase().includes(val)
            );
            if(datosFiltrados.length) {
                html += '<h3>Información de cuidado personal</h3>' + datosFiltrados.map(d => `
                    <div class="producto" style="background:#fffbe7;box-shadow:none;border:1px solid #ffd28a;margin-bottom:1.2rem;">
                        <h4 style="color:#7b3f00;">${d.nombre} <span style="font-size:0.9em;color:#888;">(${d.categoria})</span></h4>
                        <p><b>Problema:</b> ${d.problemas}</p>
                        <p><b>Solución:</b> ${d.soluciones}</p>
                        <p><b>Productos:</b> ${d.productos}</p>
                        <p><b>Marcas:</b> ${d.marcas}</p>
                    </div>
                `).join('');
            }
            // Rutinas y recetas ficticias
            const rutinas = getRutinasEjemplo().filter(r => r.titulo.toLowerCase().includes(val) || r.descripcion.toLowerCase().includes(val));
            if(rutinas.length) {
                html += '<h3>Rutinas</h3>' + rutinas.map(r => renderPublicacion(r, 'rutina')).join('');
            }
            const recetas = getRecetasEjemplo().filter(r => r.titulo.toLowerCase().includes(val) || r.descripcion.toLowerCase().includes(val));
            if(recetas.length) {
                html += '<h3>Recetas</h3>' + recetas.map(r => renderPublicacion(r, 'receta')).join('');
            }
            resultadosGlobal.innerHTML = html || '<p>No hay resultados.</p>';
            cargarResenas();
            cargarInteraccionesFeed();
        });
    }
    </script>
</body>
</html>
